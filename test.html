<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Advanced Attention Tracker</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body { background-color: #111; color: #0f0; font-family: monospace; padding: 20px; display: flex; gap: 40px; }
        .panel { background: #222; padding: 20px; border-radius: 10px; border: 1px solid #444; width: 480px; }
        img { border: 2px solid lime; border-radius: 8px; width: 100%; height: auto; background: #000; }
        h2, h3 { margin-top: 0; }
        .data-row { font-size: 20px; margin: 15px 0; display: flex; justify-content: space-between; border-bottom: 1px solid #333; padding-bottom: 5px; }
        strong { color: white; }
        #attn-val { color: lime; font-weight: bold; }
    </style>
</head>
<body>

    <div class="panel">
        <h2>Live Vision Feed</h2>
        <img id="video-stream" src="" alt="Waiting for Python Camera..." />
    </div>
    
    <div class="panel">
        <h2>Telemetry Analytics</h2>
        <h3 id="status" style="color: yellow;">Connecting to Node server...</h3>
        
        <div class="data-row"><span>Attention Score:</span> <strong id="attn-val">100%</strong></div>
        <div class="data-row"><span>Total Blinks:</span> <strong id="blinks-val">0</strong></div>
        <div class="data-row"><span>Eye Aspect Ratio (EAR):</span> <strong id="ear-val">0.000</strong></div>
        <div class="data-row"><span>Head Direction:</span> <strong id="head-val">FORWARD</strong></div>
        <br>
        <div class="data-row"><span>Avg Gaze X:</span> <strong id="x-val">0.000</strong></div>
        <div class="data-row"><span>Avg Gaze Y:</span> <strong id="y-val">0.000</strong></div>
    </div>

    <script>
        const socket = io('http://localhost:5000');
        
        const elements = {
            status: document.getElementById('status'),
            video: document.getElementById('video-stream'),
            x: document.getElementById('x-val'),
            y: document.getElementById('y-val'),
            attn: document.getElementById('attn-val'),
            blinks: document.getElementById('blinks-val'),
            ear: document.getElementById('ear-val'),
            head: document.getElementById('head-val')
        };

        socket.on('connect', () => {
            elements.status.innerText = "ðŸŸ¢ Connected to Node Relay!";
            elements.status.style.color = "lime";
        });

        socket.on('disconnect', () => {
            elements.status.innerText = "ðŸ”´ Disconnected.";
            elements.status.style.color = "red";
        });

        socket.on('pupil_move', (data) => {
            // Update Video
            elements.video.src = data.video_frame;

            // Update Coordinates
            elements.x.innerText = data.average.x.toFixed(3);
            elements.y.innerText = data.average.y.toFixed(3);

            // Update New Metrics
            elements.blinks.innerText = data.metrics.blinks;
            elements.ear.innerText = data.metrics.ear.toFixed(3);
            elements.head.innerText = data.metrics.head;
            
            // Dynamic Attention Color
            const attn = data.metrics.attention;
            elements.attn.innerText = `${attn.toFixed(1)}%`;
            elements.attn.style.color = attn > 70 ? 'lime' : (attn > 40 ? 'yellow' : 'red');
        });
    </script>
</body>
</html>